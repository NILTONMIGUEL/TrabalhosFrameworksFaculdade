<?php 
include('layouts/header.php'); 

// 1. Captura e formata a data de nascimento com seguranÃ§a
$dataNascimento = filter_input(INPUT_POST, "data_nascimento");

// Verifica se a data foi enviada e nÃ£o estÃ¡ vazia
if (!$dataNascimento) {
    echo "Por favor, insira a data de nascimento no formulÃ¡rio.";
    exit;
}

// Cria um objeto DateTime para a data de nascimento (formato YYYY-MM-DD)
$dataObjetoNascimento = new DateTime($dataNascimento);
$mesNascimento = (int)$dataObjetoNascimento->format('m');
$diaNascimento = (int)$dataObjetoNascimento->format('d');

// 2. Carrega o XML
$signos = simplexml_load_file("signos.xml"); 

if ($signos === false) {
    echo "Erro: NÃ£o foi possÃ­vel carregar o arquivo signos.xml. Verifique o caminho.";
    exit;
}

$signoEncontrado = null;

// 3. Itera sobre cada signo no XML e compara as datas
foreach ($signos->signo as $signo) {
    // Pega as strings de data (ex: "21/03")
    $dataInicioStr = (string)$signo->dataInicio;
    $dataFimStr = (string)$signo->dataFim;
    
    // Converte as strings para MÃªs e Dia (usando o formato DD/MM)
    list($diaInicio, $mesInicio) = explode('/', $dataInicioStr);
    list($diaFim, $mesFim) = explode('/', $dataFimStr);

    // Converte tudo para Inteiro para facilitar a comparaÃ§Ã£o
    $diaInicio = (int)$diaInicio;
    $mesInicio = (int)$mesInicio;
    $diaFim = (int)$diaFim;
    $mesFim = (int)$mesFim;

    // --- LÃ“GICA DE COMPARAÃ‡ÃƒO DE SIGNOS ---

    // A maioria dos signos fica dentro do mesmo mÃªs ou cruza o final de um mÃªs para o comeÃ§o do prÃ³ximo.
    
    // Caso 1: O signo comeÃ§a e termina DENTRO do mesmo ano (Mais de 90% dos casos)
    // Ex: Ãries (MarÃ§o -> Abril)
    if ($mesInicio <= $mesFim) {
        if ($mesNascimento > $mesInicio && $mesNascimento < $mesFim) {
            $signoEncontrado = $signo;
            break;
        } elseif ($mesNascimento == $mesInicio && $diaNascimento >= $diaInicio) {
            $signoEncontrado = $signo;
            break;
        } elseif ($mesNascimento == $mesFim && $diaNascimento <= $diaFim) {
            $signoEncontrado = $signo;
            break;
        }
    } 
    
    // Caso 2: O signo CRUZA a virada do ano (CapricÃ³rnio, AquÃ¡rio, Peixes - em alguns modelos)
    // No seu XML, apenas CapricÃ³rnio (Dez/Jan) e AquÃ¡rio/Peixes/Ãries/etc. (que comeÃ§am em Jan/Fev/Mar)
    // Como a sua lista Ã© contÃ­nua, vamos focar no cruzamento do final do ano (CapricÃ³rnio)
    if ($mesInicio > $mesFim) { // Ex: CapricÃ³rnio (Dezembro a Janeiro)
        if (($mesNascimento == $mesInicio && $diaNascimento >= $diaInicio) || 
            ($mesNascimento == $mesFim && $diaNascimento <= $diaFim) ||
            ($mesNascimento > $mesInicio || $mesNascimento < $mesFim)) { // Para o caso de haver um signo que ocupe um mÃªs inteiro entre Dez e Jan
            $signoEncontrado = $signo;
            break;
        }
    }
}

// 4. Resultado Final
echo "--- Resultado do Signo ---<br>";
if ($signoEncontrado) {
    echo "ðŸŽ‰ Seu signo Ã©: **" . (string)$signoEncontrado->signoNome . "**<br>";
    echo "DescriÃ§Ã£o: " . (string)$signoEncontrado->descricao;
} else {
    echo "NÃ£o foi possÃ­vel determinar o signo. Verifique as datas no XML.";
}

?>