<?php 
include('layouts/header.php'); 

// 1. Captura e formata a data de nascimento com segurança
$dataNascimento = filter_input(INPUT_POST, "data_nascimento");

// Verifica se a data foi enviada e não está vazia
if (!$dataNascimento) {
    echo "Por favor, insira a data de nascimento no formulário.";
    exit;
}

// Cria um objeto DateTime para a data de nascimento (formato YYYY-MM-DD)
$dataObjetoNascimento = new DateTime($dataNascimento);
$mesNascimento = (int)$dataObjetoNascimento->format('m');
$diaNascimento = (int)$dataObjetoNascimento->format('d');

// 2. Carrega o XML
$signos = simplexml_load_file("signos.xml"); 

if ($signos === false) {
    echo "Erro: Não foi possível carregar o arquivo signos.xml. Verifique o caminho.";
    exit;
}

$signoEncontrado = null;

// 3. Itera sobre cada signo no XML e compara as datas
foreach ($signos->signo as $signo) {
    // Pega as strings de data (ex: "21/03")
    $dataInicioStr = (string)$signo->dataInicio;
    $dataFimStr = (string)$signo->dataFim;
    
    // Converte as strings para Mês e Dia (usando o formato DD/MM)
    list($diaInicio, $mesInicio) = explode('/', $dataInicioStr);
    list($diaFim, $mesFim) = explode('/', $dataFimStr);

    // Converte tudo para Inteiro para facilitar a comparação
    $diaInicio = (int)$diaInicio;
    $mesInicio = (int)$mesInicio;
    $diaFim = (int)$diaFim;
    $mesFim = (int)$mesFim;

    // --- LÓGICA DE COMPARAÇÃO DE SIGNOS ---

    // A maioria dos signos fica dentro do mesmo mês ou cruza o final de um mês para o começo do próximo.
    
    // Caso 1: O signo começa e termina DENTRO do mesmo ano (Mais de 90% dos casos)
    // Ex: Áries (Março -> Abril)
    if ($mesInicio <= $mesFim) {
        if ($mesNascimento > $mesInicio && $mesNascimento < $mesFim) {
            $signoEncontrado = $signo;
            break;
        } elseif ($mesNascimento == $mesInicio && $diaNascimento >= $diaInicio) {
            $signoEncontrado = $signo;
            break;
        } elseif ($mesNascimento == $mesFim && $diaNascimento <= $diaFim) {
            $signoEncontrado = $signo;
            break;
        }
    } 
    
    // Caso 2: O signo CRUZA a virada do ano (Capricórnio, Aquário, Peixes - em alguns modelos)
    // No seu XML, apenas Capricórnio (Dez/Jan) e Aquário/Peixes/Áries/etc. (que começam em Jan/Fev/Mar)
    // Como a sua lista é contínua, vamos focar no cruzamento do final do ano (Capricórnio)
    if ($mesInicio > $mesFim) { // Ex: Capricórnio (Dezembro a Janeiro)
        if (($mesNascimento == $mesInicio && $diaNascimento >= $diaInicio) || 
            ($mesNascimento == $mesFim && $diaNascimento <= $diaFim) ||
            ($mesNascimento > $mesInicio || $mesNascimento < $mesFim)) { // Para o caso de haver um signo que ocupe um mês inteiro entre Dez e Jan
            $signoEncontrado = $signo;
            break;
        }
    }
}

// 4. Resultado Final
echo "--- Resultado do Signo ---<br>";
if ($signoEncontrado) {
    echo "🎉 Seu signo é: **" . (string)$signoEncontrado->signoNome . "**<br>";
    echo "Descrição: " . (string)$signoEncontrado->descricao;
} else {
    echo "Não foi possível determinar o signo. Verifique as datas no XML.";
}

?>